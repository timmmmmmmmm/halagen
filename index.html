<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>halagen</title>
    <link rel="icon" type="image/svg+xml" href="icons/heads/Screw_Head_-_Hex_Socket.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="styles-bootstrap.css">
</head>
<body>
    <div class="container-fluid"  style="max-width: 800px;">
        <div class="header-logo">
            <img src="img/header.png" alt="HALAGEN" class="logo">
        </div>
        <header>
        </header>

        <main>
            <div class="tab-container">
                <div class="btn-group w-100 mb-2" role="group" aria-label="Tab selection">
                    <button class="btn btn-outline-primary active" data-tab="single">Single</button>
                    <button class="btn btn-outline-primary" data-tab="batch">Batch</button>
                </div>
            </div>

            <div class="tab-content" id="single-tab">
                <!-- Dimensions Toolbar -->
                <div class="dimensions-toolbar d-flex align-items-center justify-content-center p-2 mb-2 border rounded bg-light">
                    <div class="toolbar-group d-flex align-items-center">
                        <small class="me-2 text-secondary">Width</small>
                        <div class="input-group input-group-sm me-4" style="width: 100px;">
                            <input type="number" id="label-width" class="form-control text-center" min="20" max="100" value="50" title="Custom width from 20-100mm">
                            <span class="input-group-text">mm</span>
                        </div>
                        <small class="me-2 text-secondary">Height</small>
                        <div class="input-group input-group-sm me-4" style="width: 100px;">
                            <input type="number" id="label-height" class="form-control text-center" min="9" max="50" value="12" title="Label height in millimeters">
                            <span class="input-group-text">mm</span>
                        </div>
                        <button type="button" class="btn btn-outline-secondary btn-sm toggle-btn" id="export-rotate-btn" title="Toggle 90° rotation for output">
                            <i class="bi bi-arrow-clockwise"></i> Output 90°
                        </button>
                        <input type="checkbox" id="export-rotate" style="display: none;">
                        <input type="hidden" id="png-dpi" value="300">
                    </div>
                </div>
                
                <div class="wysiwyg-editor">
                    <!-- Preview and controls container -->
                    <div class="preview-container">
                        <!-- Main preview -->
                        <div class="preview-area">
                            <div id="header-label-preview" class="label">
                                <div class="label-icon clickable-icon" title="Click to change icon">
                                    <img class="icon" src="icons/heads/Screw_Head_-_Hex_Socket.svg" alt="heads_hex_socket">
                                </div>
                                <div class="label-icon-2 clickable-icon" title="Click to change second icon" style="display: none;">
                                    <img class="icon" src="icons/heads/Screw_Head_-_Hex_Socket.svg" alt="heads_hex_socket">
                                </div>
                                <div class="label-text">
                                    <div class="main-text">
                                        <div class="main-text-column editable-text" contenteditable="true">M3</div>
                                        <div class="main-text-column editable-text" contenteditable="true">M3</div>
                                        <div class="main-text-column editable-text" contenteditable="true">M3</div>
                                    </div>
                                    <div class="sub-text">
                                        <div class="sub-text-column editable-text" contenteditable="true">8 mm</div>
                                        <div class="sub-text-column editable-text" contenteditable="true">10 mm</div>
                                        <div class="sub-text-column editable-text" contenteditable="true">12 mm</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Label Structure Toolbar -->
                <div class="structure-toolbar p-3 mb-3 border rounded bg-light">
                    <!-- Row 1: Icon Settings + Main Text Settings -->
                    <div class="toolbar-row d-flex align-items-center mb-3">
                        <!-- Column 1: Icon Settings -->
                        <div class="toolbar-column me-4" style="width: 254px;">
                            <div class="btn-group btn-group-sm icon-count-selector" role="group" aria-label="Icon count selection">
                                <button type="button" class="btn btn-outline-secondary" data-icon-count="0" title="No icons - text only">
                                    <i class="bi bi-ban"></i> <br>No icon
                                </button>
                                <button type="button" class="btn btn-outline-secondary active" data-icon-count="1" title="Single icon (current)">
                                    <i class="bi bi-image"></i> <br>One icon
                                </button>
                                <button type="button" class="btn btn-outline-secondary" data-icon-count="2" title="Two icons">
                                    <i class="bi bi-images"></i> <br>Two icons
                                </button>
                            </div>
                        </div>
                        <!-- Column 2: Main Text (all on one line) -->
                        <div class="toolbar-column d-flex align-items-center">
                            <small class="me-3 text-secondary fw-bold" style="min-width: 70px;">Main Text</small>
                            <div class="input-group input-group-sm me-3" style="width: 120px;">
                                <button type="button" class="btn btn-outline-secondary column-btn-small" data-action="remove" data-type="main" title="Remove column">-</button>
                                <span class="input-group-text column-count" id="main-column-count">3</span>
                                <button type="button" class="btn btn-outline-secondary column-btn-small" data-action="add" data-type="main" title="Add column (max 4)">+</button>
                            </div>
                            <div class="btn-group btn-group-sm global-main-align-selector" role="group" aria-label="Main text alignment">
                                <button type="button" class="btn btn-outline-primary active" data-align="left" title="Main text - Align left">
                                    <i class="bi bi-text-left"></i>
                                </button>
                                <button type="button" class="btn btn-outline-primary" data-align="center" title="Main text - Align center">
                                    <i class="bi bi-text-center"></i>
                                </button>
                                <button type="button" class="btn btn-outline-primary" data-align="right" title="Main text - Align right">
                                    <i class="bi bi-text-right"></i>
                                </button>
                                <button type="button" class="btn btn-outline-primary" data-align="justify" title="Main text - Justify">
                                    <i class="bi bi-justify"></i>
                                </button>
                                <button type="button" class="btn btn-outline-warning" data-align="custom" title="Main text - Custom per-cell alignment">
                                    <i class="bi bi-gear"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 2: Sub Text Settings -->
                    <div class="toolbar-row d-flex align-items-center">
                        <!-- Column 1: Empty spacer -->
                        <div class="toolbar-column me-4" style="width: 254px;"></div>
                        <!-- Column 2: Sub Text (all on one line) -->
                        <div class="toolbar-column d-flex align-items-center">
                            <small class="me-3 text-secondary fw-bold" style="min-width: 70px;">Sub Text</small>
                            <div class="input-group input-group-sm me-3" style="width: 120px;">
                                <button type="button" class="btn btn-outline-secondary column-btn-small" data-action="remove" data-type="sub" title="Remove sub-text column">-</button>
                                <span class="input-group-text column-count" id="sub-column-count">3</span>
                                <button type="button" class="btn btn-outline-secondary column-btn-small" data-action="add" data-type="sub" title="Add sub-text column (max 4)">+</button>
                            </div>
                            <div class="btn-group btn-group-sm global-sub-align-selector" role="group" aria-label="Sub text alignment">
                                <button type="button" class="btn btn-outline-primary active" data-align="left" title="Sub text - Align left">
                                    <i class="bi bi-text-left"></i>
                                </button>
                                <button type="button" class="btn btn-outline-primary" data-align="center" title="Sub text - Align center">
                                    <i class="bi bi-text-center"></i>
                                </button>
                                <button type="button" class="btn btn-outline-primary" data-align="right" title="Sub text - Align right">
                                    <i class="bi bi-text-right"></i>
                                </button>
                                <button type="button" class="btn btn-outline-primary" data-align="justify" title="Sub text - Justify">
                                    <i class="bi bi-justify"></i>
                                </button>
                                <button type="button" class="btn btn-outline-warning" data-align="custom" title="Sub text - Custom per-cell alignment">
                                    <i class="bi bi-gear"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- QR Code - Commented out for later implementation -->
                <!-- 
                <div class="toolbar-group d-flex align-items-center me-3">
                    <div class="input-group input-group-sm" style="max-width: 200px;">
                        <span class="input-group-text"><i class="bi bi-qr-code"></i></span>
                        <input type="url" id="qr-url-input" class="form-control" placeholder="URL" maxlength="2048" title="Enter URL to generate QR code">
                    </div>
                    <div id="qr-preview" class="ms-2" style="display: none;">
                        <canvas id="qr-canvas" width="40" height="40"></canvas>
                    </div>
                </div>
                -->
                
                
                
                <div class="controls">
                    <select id="icon-select" style="display: none;">
                        <option value="heads_hex_socket" selected>Hex Socket</option>
                    </select>

                    <!-- Hidden text inputs for compatibility -->
                    <div id="main-text-inputs" style="display: none;">
                        <input type="text" class="main-text-input" value="M3">
                        <input type="text" class="main-text-input" value="M3">
                        <input type="text" class="main-text-input" value="M3">
                    </div>
                    <div id="sub-text-inputs" style="display: none;">
                        <input type="text" class="sub-text-input" value="8 mm">
                        <input type="text" class="sub-text-input" value="10 mm">
                        <input type="text" class="sub-text-input" value="12 mm">
                    </div>


                    <!-- Simplified Download Section -->
                    <div class="download-section mt-4">
                        <div class="row g-2">
                            <div class="col-md-4">
                                <div class="btn-group w-100" role="group">
                                    <button id="download-png" class="btn btn-success flex-grow-1 text-center" title="Download PNG (300 DPI)" data-dpi="300">
                                        <i class="bi bi-download me-2"></i>PNG
                                    </button>
                                    <button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split px-2" data-bs-toggle="dropdown" aria-expanded="false" style="flex: 0 0 auto;">
                                        <span class="visually-hidden">Toggle Dropdown</span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" id="download-png-96" data-dpi="96">PNG - 96 DPI (Default)</a></li>
                                        <li><a class="dropdown-item" href="#" id="download-png-203" data-dpi="203">PNG - 203 DPI (Niimbot)</a></li>
                                        <li><a class="dropdown-item" href="#" id="download-png-300" data-dpi="300">PNG - 300 DPI (High Quality)</a></li>
                                        <li><a class="dropdown-item" href="#" id="download-png-600" data-dpi="600">PNG - 600 DPI (Print)</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button id="download-svg" class="btn btn-primary w-100" title="Download as vector SVG (scalable and editable)">
                                    <i class="bi bi-download me-2"></i>SVG
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-outline-info w-100" id="copy-yaml-btn" title="Copy current settings as YAML for batch processing">
                                    <i class="bi bi-clipboard-plus me-2"></i>Copy YAML
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="tab-content" id="batch-tab" style="display: none;">
                <div class="batch-controls">
                    <div class="mb-3">
                        <label for="yaml-input" class="form-label">YAML Input</label>
                        <textarea id="yaml-input" class="form-control" rows="20" placeholder="Loading template..."></textarea>
                    </div>


                    <div class="row g-2">
                        <div class="col-6">
                            <button id="validate-yaml" class="btn btn-outline-primary w-100" title="Check YAML syntax and validate label data">Validate YAML</button>
                        </div>
                        <div class="col-6">
                            <button id="generate-zip" class="btn btn-success w-100" title="Generate all labels and download as ZIP file">Generate and Download ZIP</button>
                        </div>
                    </div>

                    <div id="validation-result" class="validation-result"></div>
                </div>
            </div>
        </main>
        
        <footer>
            <div class="attribution">
                <p><svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 8px;"><path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.30.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg><a href="https://github.com/timmmmmmmmm/halagen" target="_blank">halagen (hardware label generator)</a> by <a href="https://www.timvanderheide.com" target="_blank">Tim van der Heide</a></p>
                <p>Icon set by <a href="https://www.printables.com/model/621771-gridfinity-bin-label-icons" target="_blank">Joe Jankowiak</a> 
                   - Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a></p>
                <div class="mt-2">
                    <a href="https://ko-fi.com/timvdh" target="_blank" class="btn btn-outline-warning btn-sm">
                        <i class="bi bi-cup-hot" style="margin-right: 5px;"></i>
                        Buy me a coffee
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Text alignment tooltip -->
    <div id="text-alignment-tooltip" class="text-alignment-tooltip">
        <div class="alignment-buttons">
            <button type="button" class="alignment-btn" data-align="left" title="Align left">
                <i class="bi bi-text-left"></i>
            </button>
            <button type="button" class="alignment-btn" data-align="center" title="Align center">
                <i class="bi bi-text-center"></i>
            </button>
            <button type="button" class="alignment-btn" data-align="right" title="Align right">
                <i class="bi bi-text-right"></i>
            </button>
            <button type="button" class="alignment-btn" data-align="justify" title="Justify">
                <i class="bi bi-justify"></i>
            </button>
        </div>
    </div>

    <!-- Icon picker overlay - moved to body level -->
    <div class="icon-picker-overlay"></div>

    <!-- Icon picker modal - moved to body level -->
    <div id="icon-picker" class="icon-picker" style="display: none;">
        <div class="icon-picker-header">
            <h3>Choose Icon</h3>
            <button type="button" class="icon-picker-close" onclick="labelMaker.closeIconPicker()">×</button>
        </div>
        <div class="icon-picker-search">
            <input type="text" placeholder="Search icons..." id="icon-search">
            <input type="file" id="icon-upload" accept="image/png" style="display: none;">
            <button type="button" id="upload-icon-btn" class="upload-icon-btn" title="Upload a custom PNG icon (any aspect ratio, black & white recommended)">📁 Upload Custom Icon</button>
        </div>
        <div class="icon-picker-grid" id="icon-grid">
            <!-- Icons will be populated by JavaScript -->
        </div>
        
        <!-- Hidden elements for compatibility -->
        <div class="icon-picker-selected" style="display: none;">
            <div class="selected-icon" data-icon="heads_hex_socket">
                <img src="icons/heads/Screw_Head_-_Hex_Socket.svg" alt="heads_hex_socket">
                <span>Hex Socket</span>
            </div>
            <button type="button" class="icon-picker-button">Choose Icon</button>
        </div>
    </div>

    <script src="lib/jszip.min.js"></script>
    <link rel="stylesheet" href="lib/codemirror.css">
    <script src="lib/codemirror.js"></script>
    <script src="lib/yaml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        // Handle rotation toggle button and PNG download options
        document.addEventListener('DOMContentLoaded', function() {
            const rotateBtn = document.getElementById('export-rotate-btn');
            const rotateCheckbox = document.getElementById('export-rotate');
            
            if (rotateBtn && rotateCheckbox) {
                rotateBtn.addEventListener('click', function() {
                    rotateCheckbox.checked = !rotateCheckbox.checked;
                    if (rotateCheckbox.checked) {
                        rotateBtn.classList.remove('btn-outline-secondary');
                        rotateBtn.classList.add('btn-primary');
                    } else {
                        rotateBtn.classList.remove('btn-primary');
                        rotateBtn.classList.add('btn-outline-secondary');
                    }
                });
            }
            
            // Handle PNG download dropdown options
            const pngDropdownItems = document.querySelectorAll('#download-png-96, #download-png-203, #download-png-300, #download-png-600');
            const pngDpiInput = document.getElementById('png-dpi');
            const mainPngBtn = document.getElementById('download-png');
            
            pngDropdownItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const dpi = this.dataset.dpi;
                    if (pngDpiInput) {
                        pngDpiInput.value = dpi;
                    }
                    if (mainPngBtn) {
                        mainPngBtn.dataset.dpi = dpi;
                        mainPngBtn.title = `Download PNG (${dpi} DPI)`;
                    }
                    // Trigger download
                    if (typeof labelMaker !== 'undefined') {
                        labelMaker.downloadPNG();
                    }
                });
            });
        });
    </script>
</body>
</html>
